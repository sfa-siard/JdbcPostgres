/*======================================================================
PostgresConnection implements a wrapped PostgreSQL Connection.
Application : SIARD2
Description : PostgresConnection implements a wrapped PostgreSQL Connection.
Platform    : Java 8-10   
------------------------------------------------------------------------
Copyright  : 2019, Swiss Federal Archives, Berne, Switzerland
License    : CDDL 1.0
Created    : 22.07.2017, Hartwig Thomas, Enter AG, RÃ¼ti ZH, Switzerland
======================================================================*/
package ch.admin.bar.siard2.jdbc;

import java.sql.*;
import ch.admin.bar.siard2.postgres.*;
import ch.enterag.sqlparser.*;
import ch.enterag.utils.jdbc.*;
import ch.enterag.utils.logging.*;

/*====================================================================*/
/** PostgresConnection implements a wrapped PostgreSQL Connection.
 * @author Hartwig Thomas
 */
public class PostgresConnection
extends BaseConnection
implements Connection
{
  /** logger */
  private static IndentLogger _il = IndentLogger.getIndentLogger(PostgresConnection.class.getName());
  
  /*------------------------------------------------------------------*/
  /** constructor
   * @param connWrapped connection to be wrapped.
   */
  public PostgresConnection(Connection connWrapped)
    throws SQLException
  {
    super(connWrapped);
  } /* constructor */
  
  /*------------------------------------------------------------------*/
  /** {@inheritDoc} */
  @Override
  public String nativeSQL(String sql) 
    throws SQLException
  {
    _il.enter(sql);
    SqlFactory sf = new PostgresSqlFactory();
    SqlStatement ss = sf.newSqlStatement();
    ss.parse(sql);
    sql = ss.format();
    _il.exit(sql);
    return sql;
  } /* nativeSQL */

  /*------------------------------------------------------------------*/
  /**
   * {@inheritDoc} wraps statement.
   */
  @Override
  public Statement createStatement() throws SQLException 
  {
    Statement stmt = super.createStatement();
    return new PostgresStatement(stmt);
  } /* createStatement */

  /*------------------------------------------------------------------*/
  /**
   * {@inheritDoc} wraps statement.
   */
  @Override
  public Statement createStatement(int resultSetType, int resultSetConcurrency) throws SQLException 
  {
    Statement stmt = super.createStatement(resultSetType, resultSetConcurrency);
    return new PostgresStatement(stmt);
  } /* createStatement */
  
  /*------------------------------------------------------------------*/
  /** {@inheritDoc} */
  @Override
  public Statement createStatement(int resultSetType,
    int resultSetConcurrency, int resultSetHoldability)
    throws SQLException
  {
    Statement stmt = super.createStatement(resultSetType, resultSetConcurrency, resultSetHoldability);
    return new PostgresStatement(stmt);
  } /* createStatement */

  /*------------------------------------------------------------------*/
  /** {@inheritDoc} */
  @Override
  public PreparedStatement prepareStatement(String sql) throws SQLException 
  {
    String sNative = nativeSQL(sql);
    PreparedStatement ps = super.prepareStatement(sNative);
    return ps;
  } /* prepareStatement */

  /*------------------------------------------------------------------*/
  /** {@inheritDoc} */
  @Override
  public PreparedStatement prepareStatement(String sql, int resultSetType, int resultSetConcurrency) throws SQLException 
  {
    String sNative = nativeSQL(sql);
    PreparedStatement ps = super.prepareStatement(sNative, resultSetType, resultSetConcurrency);
    return ps;
  } /* prepareStatement */

  /*------------------------------------------------------------------*/
  /** {@inheritDoc} */
  @Override
  public PreparedStatement prepareStatement(String sql, int resultSetType, int resultSetConcurrency, int resultSetHoldability) throws SQLException
  {
    String sNative = nativeSQL(sql);
    PreparedStatement ps = super.prepareStatement(sNative, resultSetType, resultSetConcurrency, resultSetHoldability);
    return ps;
  } /* prepareStatement */
  
  /*------------------------------------------------------------------*/
  /** {@inheritDoc} */
  @Override
  public PreparedStatement prepareStatement(String sql, int autoGeneratedKeys) throws SQLException 
  {
    String sNative = nativeSQL(sql);
    PreparedStatement ps = super.prepareStatement(sNative, autoGeneratedKeys);
    return ps;
  } /* prepareStatement */
  
  /*------------------------------------------------------------------*/
  /** {@inheritDoc} */
  @Override
  public PreparedStatement prepareStatement(String sql, int[] columnIndexes) throws SQLException 
  {
    String sNative = nativeSQL(sql);
    PreparedStatement ps = super.prepareStatement(sNative, columnIndexes);
    return ps;
  } /* prepareStatement */
  
  /*------------------------------------------------------------------*/
  /** {@inheritDoc} */
  @Override
  public PreparedStatement prepareStatement(String sql, String[] columnNames) throws SQLException 
  {
    String sNative = nativeSQL(sql);
    PreparedStatement ps = super.prepareStatement(sNative, columnNames);
    return ps;
  } /* prepareStatement */
  
  /*------------------------------------------------------------------*/
  /** {@inheritDoc} */
  @Override
  public CallableStatement prepareCall(String sql) throws SQLException 
  {
    String sNative = nativeSQL(sql);
    CallableStatement cs = super.prepareCall(sNative);
    return cs;
  } /* prepareCall */
  
  /*------------------------------------------------------------------*/
  /** {@inheritDoc} */
  @Override
  public CallableStatement prepareCall(String sql, int resultSetType, int resultSetConcurrency) throws SQLException 
  {
    String sNative = nativeSQL(sql);
    CallableStatement cs = super.prepareCall(sNative, resultSetType, resultSetConcurrency);
    return cs;
  } /* prepareCall */
  
  /*------------------------------------------------------------------*/
  /** {@inheritDoc} */
  @Override
  public CallableStatement prepareCall(String sql, int resultSetType, int resultSetConcurrency, int resultSetHoldability) throws SQLException 
  {
    String sNative = nativeSQL(sql);
    CallableStatement cs = super.prepareCall(sNative, resultSetType, resultSetConcurrency, resultSetHoldability);
    return cs;
  } /* prepareCall */

  /*------------------------------------------------------------------*/
  /** {@inheritDoc}
   * wraps database meta data.
   */
  @Override
  public DatabaseMetaData getMetaData()
    throws SQLException
  {
    DatabaseMetaData dmd = new PostgresDatabaseMetaData(super.getMetaData());
    return dmd;
  } /* getMetadata */

} /* class PostgresConnection */
